{"version":3,"file":"index.js","sources":["../index.js"],"sourcesContent":["export default {\n    version: '1.0.0',\n    install: installVFlowGrid\n};\n\nconst INIT_FLAG = 'vflowgrid';\n\n/**\n * this will decide whether to update DOM\n */\nconst shouldUpdate = (el, binding, vnode, oldVnode) => {\n    const attr = +binding.value;\n\n    if (isNaN(attr) || attr <= 0 || Math.round(attr) !== attr) {\n        console.warn('the value `v-flow-grid` must be a positive number');\n        return false;\n    }\n\n    const initialized     = () => !!el.getAttribute(INIT_FLAG);\n    const bindingChanged  = () => attr !== binding.oldValue;\n    const childrenChanged = () => vnode.children.length !== oldVnode.children.length;\n    return !initialized() || bindingChanged() || childrenChanged();\n};\n\n/**\n * calculate appropriate index of the column to which\n * we should append the next item\n */\nconst getAppendCol = function (columns) {\n    let minH = columns[0].offsetHeight;\n    return columns.slice(1).reduce((accu, col, i) => {\n        if (col.offsetHeight < minH) {\n            minH = col.offsetHeight;\n            accu = i + 1;\n        }\n        return accu;\n    }, 0);\n};\n\n/**\n * add an element for clearfix\n */\nconst clearfix = (el) => {\n    const cf = document.createElement('i');\n    const style = cf.style;\n    style.clear = 'both';\n    style.visibility = 'hidden';\n    style.width = 0;\n    style.height = 0;\n    return cf;\n};\n\nfunction installVFlowGrid(Vue, options) {\n    Vue.directive('flowgrid', {\n        inserted: function (el, binding, vnode, oldVnode) {\n            /**\n             * hide each item as soon as they are inserted\n             * to avoid flash of content.\n             * here we use `visibility: hidden` instead of\n             * `display: none`, because offsetHeight of items\n             * are required when calculating\n             */\n            Array.from(el.children).forEach(li => {\n                li.style && (li.style.visibility = 'hidden');\n            });\n\n            // do reflow\n            reflow(el, binding, vnode, oldVnode);\n        },\n        componentUpdated: reflow\n    });\n}\n\nfunction reflow(el, binding, vnode, oldVnode) {\n    // avoid unneccesary updates\n    if (!shouldUpdate(el, binding, vnode, oldVnode)) {\n        return;\n    }\n\n    // grids\n    const items = vnode.children.reduce((accu, item) => {\n        if (!!item.tag) {\n            accu.push(item.elm);\n        }\n        return accu;\n    }, []);\n    \n    if (items.length === 0) {\n        return;\n    }\n\n    // colums\n    const colNum  = Math.min(binding.value, items.length);\n    const columns = Array.from({ length: colNum }, () => {\n        const col = document.createElement('div');\n        col.style.width = `${100 / colNum}%`;\n        col.style.float = 'left';\n        return col;\n    });\n\n    // mark `el` as initialized\n    el.setAttribute(INIT_FLAG, true);\n\n    // remove elements first\n    Array.from(el.children).map(item => el.removeChild(item));\n\n    // append col to element\n    columns.map(c => el.appendChild(c));\n\n    // start to append items\n    items.forEach((item, i) => {\n        columns[i < colNum ? i : getAppendCol(columns)].appendChild(item);\n        item.style && (item.style.visibility = 'visible');\n    });\n\n    // clearfix\n    el.appendChild(clearfix());\n}"],"names":["const","let"],"mappings":"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"}